var bbcat_360=function(t){function e(a){if(r[a])return r[a].exports;var i=r[a]={exports:{},id:a,loaded:!1};return t[a].call(i.exports,i,i.exports,e),i.loaded=!0,i.exports}var r={};return e.m=t,e.c=r,e.p="",e(0)}([function(t,e,r){"use strict";function a(t){return t&&t.__esModule?t:{"default":t}}Object.defineProperty(e,"__esModule",{value:!0});var i=r(1),n=a(i),o={};o.PanoViewer=n["default"],console.log("bbcat_360 loaded"),e["default"]=o,t.exports=e["default"]},function(t,e){"use strict";function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(e,"__esModule",{value:!0});var a=function(){function t(t,e){for(var r=0;r<e.length;r++){var a=e[r];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(t,a.key,a)}}return function(e,r,a){return r&&t(e.prototype,r),a&&t(e,a),e}}(),i=function(){function t(e,a,i){if(r(this,t),void 0===e||void 0===e.tagName||"CANVAS"!==e.tagName)throw"Invalid canvas object.";this.gl,this.canvas=e,this.fov=65,this.pano=a,this.stereo=i,this.has_texture=!1,this.orientation_controls=void 0,this.SetupWebGL(),this.quad=gl.createBuffer(),gl.bindBuffer(gl.ARRAY_BUFFER,this.quad),gl.bufferData(gl.ARRAY_BUFFER,new Float32Array([-1,-1,0,1,-1,0,-1,1,0,1,1,0]),gl.STATIC_DRAW),this.quadidx_=gl.createBuffer(),gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER,this.quadidx_),gl.bufferData(gl.ELEMENT_ARRAY_BUFFER,new Uint16Array([0,1,2,1,2,3]),gl.STATIC_DRAW),this.panotexture=gl.createTexture(),gl.bindTexture(gl.TEXTURE_2D,this.panotexture),gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_MAG_FILTER,gl.LINEAR),gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_MIN_FILTER,gl.LINEAR),gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_WRAP_S,gl.CLAMP_TO_EDGE),gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_WRAP_T,gl.CLAMP_TO_EDGE)}return a(t,[{key:"SetupWebGL",value:function(){for(var t={alpha:!1,depth:!1,stencil:!1,antialias:!1,premultipliedAlpha:!0,preserveDrawingBuffer:!1},e=["webgl","experimental-webgl"],r=0;r<e.length&&(gl=this.canvas.getContext(e[r],t),!gl);r++);if(!gl)throw"Unable to get a WebGL context.";gl.clearColor(0,0,0,1),this.SetupShaders()}},{key:"SetupShaders",value:function(){function t(t,e){var r=gl.createShader(e);return gl.shaderSource(r,t),gl.compileShader(r),gl.getShaderParameter(r,gl.COMPILE_STATUS)?r:(alert(gl.getShaderInfoLog(r)),null)}var e="attribute vec3 v_pos;\nvarying vec3 pos;\n\nvoid main() {\n  gl_Position = vec4(v_pos.xyz, 1.0);\n  pos = v_pos;\n}",r="precision highp float;\n\nvarying vec3 pos;\n\nuniform sampler2D pano;\nuniform float aspect_ratio;\nuniform float fovy;\nuniform mat4 view;\n\n#define PI 3.1415926535897932384626433832795\n\nfloat saturate(float value) {\n  return clamp(value, 0.0, 1.0);\n}\n\nvoid main() {\n  // The view ray for this fragment.\n  vec3 ray = vec3(pos.x * tan(fovy / 2.0 * aspect_ratio),\n                  pos.y * tan(fovy / 2.0), -1);\n\n  // Transform by our view matrix.\n  ray = (view * vec4(ray, 1.0)).xyz;\n  ray = normalize(ray);\n\n  // Project into pano texture coords.\n  vec2 texcoords = vec2(saturate((1.0 - atan(ray.x, ray.z) / PI) / 2.0),\n                        saturate(acos(ray.y) / PI));\n  gl_FragColor = vec4(texture2D(pano, texcoords).xyz, 1.0);\n}";this.vertex_shader_=t(e,gl.VERTEX_SHADER),this.fragment_shader_=t(r,gl.FRAGMENT_SHADER);var a=gl.createProgram();if(gl.attachShader(a,this.vertex_shader_),gl.attachShader(a,this.fragment_shader_),gl.linkProgram(a),!gl.getProgramParameter(a,gl.LINK_STATUS))throw"Could not initialize shaders";a.vertexPositionAttribute=gl.getAttribLocation(a,"v_pos");for(var i=["pano","aspect_ratio","fovy","view"],n=0;n<i.length;++n)a[i[n]+"_uniform"]=gl.getUniformLocation(a,i[n]);this.program_=a}},{key:"UpdateTexture",value:function(){this.has_texture=!0,gl.bindTexture(gl.TEXTURE_2D,this.panotexture),gl.texImage2D(gl.TEXTURE_2D,0,gl.RGBA,gl.RGBA,gl.UNSIGNED_BYTE,this.pano)}},{key:"DrawFrame",value:function(){if(this.has_texture){var t,e=90*Math.PI/180;this.stereo?(gl.viewport(0,0,this.canvas.width/2,this.canvas.height),t=this.canvas.width/2/this.canvas.height,t=Math.min(1.75,t)):(gl.viewport(0,0,this.canvas.width,this.canvas.height),t=this.canvas.width/this.canvas.height,e=this.fov*Math.PI/180),gl.useProgram(this.program_),gl.activeTexture(gl.TEXTURE0),gl.bindTexture(gl.TEXTURE_2D,this.panotexture),gl.uniform1i(this.program_.panouniform,0);var r=this.orientation_controls?this.orientation_controls.poseMat4:mat4.create();gl.uniform1f(this.program_.fovy_uniform,e),gl.uniform1f(this.program_.aspect_ratio_uniform,t),gl.uniformMatrix4fv(this.program_.view_uniform,!1,r),gl.enableVertexAttribArray(this.program_.vertexPositionAttribute),gl.bindBuffer(gl.ARRAY_BUFFER,this.quad),gl.vertexAttribPointer(this.program_.vertexPositionAttribute,3,gl.FLOAT,!1,0,0),gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER,this.quadidx_),gl.drawElements(gl.TRIANGLES,6,gl.UNSIGNED_SHORT,0),this.stereo&&(gl.viewport(this.canvas.width/2,0,this.canvas.width/2,this.canvas.height),gl.drawElements(gl.TRIANGLES,6,gl.UNSIGNED_SHORT,0)),gl.disableVertexAttribArray(this.program_.vertexPositionAttribute)}}}]),t}();e["default"]=i,t.exports=e["default"]}]);