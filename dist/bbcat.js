var bbcat=function(e){function t(r){if(n[r])return n[r].exports;var a=n[r]={exports:{},id:r,loaded:!1};return e[r].call(a.exports,a,a.exports,t),a.loaded=!0,a.exports}var n={};return t.m=e,t.c=n,t.p="",t(0)}([function(e,t,n){"use strict";function r(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t["default"]=e,t}Object.defineProperty(t,"__esModule",{value:!0}),t.dash=t.core=void 0;var a=n(1),i=r(a),o=n(7),u=r(o);t.core=i,t.dash=u,t["default"]={core:i,dash:u}},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0}),t.AudioLoader=t.Loader=t.DocumentParser=t.CompoundNode=t.EventTarget=void 0;var a=n(2),i=r(a),o=n(3),u=r(o),s=n(4),l=r(s),f=n(5),c=r(f),p=n(6),h=r(p);t.EventTarget=i["default"],t.CompoundNode=u["default"],t.DocumentParser=l["default"],t.Loader=c["default"],t.AudioLoader=h["default"]},function(e,t){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),a=function(){function e(){n(this,e),this._listeners={}}return r(e,[{key:"addEventListener",value:function(e,t){-1===this._getListenerIdx(e,t)&&(this._listeners[e]||(this._listeners[e]=[]),this._listeners[e].push(t))}},{key:"removeEventListener",value:function(e,t){var n=this._getListenerIdx(e,t);n>=0&&this._listeners[e].splice(n,1)}},{key:"dispatchEvent",value:function(e){var t=this._listeners[e.type];if(t)for(var n=0;n<t.length;n++)t[n].call(null,e)}},{key:"_getListenerIdx",value:function(e,t){var n=this._listeners[e];if(n)for(var r=0;r<n.length;r++)if(n[r]===t)return r;return-1}}]),e}();t["default"]=a},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var u=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),s=n(2),l=r(s),f=function(e){function t(e){a(this,t);var n=i(this,Object.getPrototypeOf(t).call(this));return Object.defineProperty(n,"context",{value:e,writable:!1,enumerable:!1,configurable:!0}),n._inputs=[],n._outputs=[],n}return o(t,e),u(t,[{key:"connect",value:function(e){var n=arguments.length<=1||void 0===arguments[1]?0:arguments[1],r=arguments.length<=2||void 0===arguments[2]?0:arguments[2];return e instanceof t?this._outputs[n].connect(e.inputs[r]):this._outputs[n].connect(e,0,r),e}},{key:"disconnect",value:function(e){var n=arguments.length<=1||void 0===arguments[1]?0:arguments[1],r=arguments.length<=2||void 0===arguments[2]?0:arguments[2];e instanceof t?this._outputs[n].disconnect(e.inputs[r]):this._outputs[n].disconnect(e,0,r)}},{key:"context",get:function(){return this.context}},{key:"numberOfInputs",get:function(){return this._inputs.length}},{key:"numberOfOutputs",get:function(){return this._outputs.length}}]),t}(l["default"]);t["default"]=f},function(e,t){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),a=function(){function e(t,r){n(this,e),this._models=t||[],this._parsers=r||[]}return r(e,[{key:"parse",value:function(e){var t=e.childNodes[0],n=this._models[t.nodeName];return this._parse(t,n)}},{key:"_parse",value:function(e,t){for(var n=t.attributes||[],r=t.nodes||[],a={},i=0;i<n.length;i++){var o=n[i];a[o.name]=this._parseAttribute(e,o)}for(var i=0;i<r.length;i++){var u=r[i];a[u.name]=this._parseNode(e,u)}return a}},{key:"_parseAttribute",value:function(e,t){var n=e.getAttribute(t.name)||t["default"],r=this._parsers[t.type];return r?r.call(null,n):n}},{key:"_parseNode",value:function(e,t){var n=t.node||t.name,r=this._getChildNodes(e,n);return 0===r.length?null:"many"===t.mapping?this._parseNodeMany(r,t):this._parseNodeOne(r[0],t)}},{key:"_parseNodeMany",value:function(e,t){for(var n=[],r=0;r<e.length;r++)n.push(this._parseNodeOne(e[r],t));return n}},{key:"_parseNodeOne",value:function(e,t){var n=this._models[t.type];return n?this._parse(e,n):this._flattenNodeToAttribute(e,t)}},{key:"_flattenNodeToAttribute",value:function(e,t){var n=e.textContent||t["default"],r=this._parsers[t.type];return r?r.call(null,n):n}},{key:"_getChildNodes",value:function(e,t){for(var n=[],r=0;r<e.childNodes.length;r++){var a=e.childNodes[r],i=a.nodeName;t.toLowerCase()===i.toLowerCase()&&n.push(a)}return n}}]),e}();t["default"]=a},function(e,t){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),a=function(){function e(t){n(this,e),this._responseType=t||"arraybuffer"}return r(e,[{key:"load",value:function(e){return e instanceof Array?this._loadAll(e):this._loadOne(e)}},{key:"_loadOne",value:function(e){return this._request(e)}},{key:"_loadAll",value:function(e){var t=this;return Promise.all(e.map(function(e){return t._loadOne(e)}))}},{key:"_request",value:function(e){var t=this;return new Promise(function(n,r){var a=new XMLHttpRequest;a.open("GET",e,!0),a.responseType=t._responseType,a.addEventListener("load",function(){200===this.status||304===this.status?n(a.response):r(new Error(this.statusText))}),a.addEventListener("error",function(){r(new Error("A transport error has occured."))}),a.send()})}}]),e}();t["default"]=a},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var u=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),s=function p(e,t,n){null===e&&(e=Function.prototype);var r=Object.getOwnPropertyDescriptor(e,t);if(void 0===r){var a=Object.getPrototypeOf(e);return null===a?void 0:p(a,t,n)}if("value"in r)return r.value;var i=r.get;if(void 0!==i)return i.call(n)},l=n(5),f=r(l),c=function(e){function t(e){a(this,t);var n=i(this,Object.getPrototypeOf(t).call(this,"arraybuffer"));return n._context=e,n}return o(t,e),u(t,[{key:"load",value:function(e){return s(Object.getPrototypeOf(t.prototype),"load",this).call(this,e)}},{key:"_loadOne",value:function(e){var n=this;return s(Object.getPrototypeOf(t.prototype),"_loadOne",this).call(this,e).then(function(e){return n._decode(e)})}},{key:"_decode",value:function(e){var t=this;return new Promise(function(n,r){t._context.decodeAudioData(e,n,r)})}}]),t}(f["default"]);t["default"]=c},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0}),t.DashSourceNode=t.ManifestParser=t.ManifestLoader=void 0;var a=n(8),i=r(a),o=n(9),u=r(o),s=n(12),l=r(s);t.ManifestLoader=i["default"],t.ManifestParser=u["default"],t.DashSourceNode=l["default"]},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var u=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),s=function p(e,t,n){null===e&&(e=Function.prototype);var r=Object.getOwnPropertyDescriptor(e,t);if(void 0===r){var a=Object.getPrototypeOf(e);return null===a?void 0:p(a,t,n)}if("value"in r)return r.value;var i=r.get;if(void 0!==i)return i.call(n)},l=n(5),f=r(l),c=function(e){function t(){a(this,t);var e=i(this,Object.getPrototypeOf(t).call(this,"text"));return e._parser=new DOMParser,e}return o(t,e),u(t,[{key:"load",value:function(e){return s(Object.getPrototypeOf(t.prototype),"load",this).call(this,e)}},{key:"_loadOne",value:function(e){var n=this;return s(Object.getPrototypeOf(t.prototype),"_loadOne",this).call(this,e).then(function(e){return n._parse(e)})}},{key:"_parse",value:function(e){var t=this._parser.parseFromString(e,"text/xml",0);return Promise.resolve(t)}}]),t}(f["default"]);t["default"]=c},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var u=n(1),s=n(10),l=r(s),f=n(11),c=r(f),p=function(e){function t(){return a(this,t),i(this,Object.getPrototypeOf(t).call(this,l["default"],c["default"]))}return o(t,e),t}(u.DocumentParser);t["default"]=p},function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n={attributes:[{name:"type",type:"string","default":"static"},{name:"minBufferTime",type:"period"},{name:"mediaPresentationDuration",type:"period"},{name:"maxSegmentDuration",type:"period"}],nodes:[{name:"programInformation",node:"ProgramInformation",type:"ProgramInformation",mapping:"one"},{name:"baseURL",node:"BaseURL",type:"string",mapping:"many"},{name:"periods",node:"Period",type:"Period",mapping:"many"}]},r={attributes:[{name:"moreInformationURL",type:"string"},{name:"lang",type:"string"}],nodes:[{name:"title",node:"Title",type:"string",mapping:"one"},{name:"source",node:"Source",type:"string",mapping:"one"},{name:"copyright",node:"Copyright",type:"string",mapping:"one"}]},a={attributes:[{name:"id",type:"integer","default":0},{name:"duration",type:"period","default":0},{name:"start",type:"integer","default":0}],nodes:[{name:"baseUrl",node:"BaseUrl",type:"string",mapping:"one"},{name:"adaptationSets",node:"AdaptationSet",type:"AdaptationSet",mapping:"many"}]},i={attributes:[{name:"id",type:"string"},{name:"mimeType",type:"string"},{name:"value",type:"integer"}],nodes:[{name:"segmentTemplate",node:"SegmentTemplate",type:"SegmentTemplate",mapping:"one"},{name:"representations",node:"Representation",type:"Representation",mapping:"many"}]},o={attributes:[{name:"duration",type:"integer","default":0},{name:"timescale",type:"integer","default":0},{name:"startNumber",type:"integer","default":1},{name:"presentationTimeOffset",type:"integer","default":0},{name:"media",type:"string"}]},u={attributes:[{name:"id",type:"integer","default":0},{name:"bandwidth",type:"integer"}]};t["default"]={MPD:n,ProgramInformation:r,Period:a,AdaptationSet:i,SegmentTemplate:o,Representation:u}},function(e,t){"use strict";function n(e){return parseInt(e,10)}function r(e){var t=/^P(?:(\d+)Y)?(?:(\d+)M)?(?:(\d+)D)?T(?:(\d+)H)?(?:(\d+)M)?(?:(\d+(?:.\d+)?)S)?/,n=null;if(t.test(e)){var r=t.exec(e);n=parseInt(r[1]||0,10)*a+parseInt(r[2]||0,10)*i+parseInt(r[3]||0,10)*o+parseInt(r[4]||0,10)*u+parseInt(r[5]||0,10)*s+parseFloat(r[6]||0,10)}return n}Object.defineProperty(t,"__esModule",{value:!0});var a=31536e3,i=2592e3,o=86400,u=3600,s=60;t["default"]={integer:n,period:r}},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var u=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),s=n(1),l=n(13),f=r(l),c=n(15),p=r(c),h=function(e){function t(e,n){a(this,t);var r=i(this,Object.getPrototypeOf(t).call(this,e));return r._allStreams=[],r._audioStreams=[],r._totalChannels=0,r._presentationDuration=0,r._playbackInitial=0,r._playbackOffset=0,r._playbackDuration=0,r._playbackLoop=!1,r._contextSyncTime=0,r._initStreams(n),r._initAudioGraph(),r._state="ready",r}return o(t,e),u(t,[{key:"start",value:function(){var e=arguments.length<=0||void 0===arguments[0]?0:arguments[0],t=arguments.length<=1||void 0===arguments[1]?!1:arguments[1],n=this,r=arguments.length<=2||void 0===arguments[2]?0:arguments[2],a=arguments.length<=3||void 0===arguments[3]?this._presentationDuration-r:arguments[3];if("ready"===this.state){if(0>e||e>=a)throw new Error("Invalid initial. Must be a number less than duration and greater than or equal to 0.");if(t!==!1&&t!==!0)throw new Error("Invalid loop. Must be a boolean.");if(0>r||r>=this._duration)throw new Error("Invalid offset. Must be a number less than presentationDuration and greater than or equal to 0.");if(0>=a||a>this._duration-r)throw new Error("Invalid duration. Must be a number less than presentationDuration minus offset and greater than 0.");this._playbackInitial=e,this._playbackOffset=r,this._playbackDuration=a,this._playbackLoop=t,this._state="priming";var i=this._allStreams.map(function(n){return n.prime(e,t,r,a)});Promise.all(i).then(function(){n._contextSyncTime=n.context.currentTime,n._state="playing";var e=n._allStreams.map(function(e){return new Promise(function(t){return e.start(n._contextSyncTime,t)})});Promise.all(e).then(function(){n._dispatchEndedEvent(),n._state="ready"})})}}},{key:"stop",value:function(){"playing"===this.state&&(this._allStreams.forEach(function(e){return e.stop()}),this._state="ready")}},{key:"_initStreams",value:function(e){var t=this;this._presentationDuration=e.mediaPresentationDuration;var n=e.minBufferTime,r=e.baseURL[0];e.periods.forEach(function(e){e.adaptationSets.forEach(function(a){var i=a.segmentTemplate,o={id:e.id+"-"+a.id,type:a.mimeType,start:e.start+i.presentationTimeOffset,duration:e.duration,segmentStart:i.startNumber,segmentDuration:Math.floor(i.duration/i.timescale),channelCount:a.value,templateUrl:r+i.media,bufferTime:n};if(a.mimeType.indexOf("json")>-1){var u=new p["default"](t.context,o);u.metadataCallback=t._dispatchMetadataEvent.bind(t),t._allStreams.push(u)}else if(a.mimeType.indexOf("audio")>-1){var u=new f["default"](t.context,o);t._audioStreams.push(u),t._allStreams.push(u),t._totalChannels+=u.channelCount}})})}},{key:"_initAudioGraph",value:function(){var e=this,t=0;this._audioStreams.forEach(function(n){for(var r=0;r<n.output.numberOfOutputs;r++){var a=e.context.createGain();n.output.connect(a,r),e._outputs[t]=a,t++}})}},{key:"_dispatchMetadataEvent",value:function(e){this.dispatchEvent({src:this,type:"metadata",metadata:e.metadata})}},{key:"_dispatchStateChangeEvent",value:function(e){this.dispatchEvent({src:this,type:"statechange",state:e})}},{key:"_dispatchEndedEvent",value:function(){this.dispatchEvent({src:this,type:"ended"})}},{key:"playbackTime",get:function(){return"playing"===this.state?(this.context.currentTime-this._contextSyncTime+this._playbackInitial)%this._playbackDuration+this._playbackOffset:0}},{key:"presentationDuration",get:function(){return this._presentationDuration}},{key:"state",get:function(){return this._playbackState}},{key:"_state",set:function(e){this._playbackState=e,this._dispatchStateChangeEvent(e)}}]),t}(s.CompoundNode);t["default"]=h},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var u=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),s=function h(e,t,n){null===e&&(e=Function.prototype);var r=Object.getOwnPropertyDescriptor(e,t);if(void 0===r){var a=Object.getPrototypeOf(e);return null===a?void 0:h(a,t,n)}if("value"in r)return r.value;var i=r.get;if(void 0!==i)return i.call(n)},l=n(1),f=n(14),c=r(f),p=function(e){function t(e,n){a(this,t);var r=i(this,Object.getPrototypeOf(t).call(this,e,new l.AudioLoader(e),n));return r._primerOffset=2048/48e3,r._isStreaming=!1,r._output=r._context.createChannelSplitter(r.channelCount),r}return o(t,e),u(t,[{key:"_start",value:function(){var e=this;this._isStreaming=!0,this._buffer.segments.forEach(function(t){e._startSegment(t)}),s(Object.getPrototypeOf(t.prototype),"_start",this).call(this)}},{key:"_stop",value:function(){this._isStreaming=!1,this._buffer.segments.forEach(function(e){e&&e.bufferSource&&e.bufferSource.stop()}),s(Object.getPrototypeOf(t.prototype),"_stop",this).call(this)}},{key:"_startSegment",value:function(e){if(e&&e.bufferSource){var t=e.when+this._contextSyncTime,n=e.offset+this._primerOffset,r=e.duration,a=this._context.currentTime-t;a<e.duration?e.bufferSource.start(a>0?0:t,a>0?n+a:n,a>0?r-a:r):e.bufferSource.start(0,0,0)}}},{key:"_addDataToSegment",value:function(e,t){for(var n=0;n<this._buffer.segments.length;n++){var r=this._buffer.segments[n];r.n===t&&(r.bufferSource=this._context.createBufferSource(),r.bufferSource.buffer=e,r.bufferSource.connect(this._output),this._isStreaming&&this._startSegment(r))}}},{key:"output",get:function(){return this._output}}]),t}(c["default"]);t["default"]=p},function(e,t){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),a=function(){function e(t,r,a){n(this,e),this._context=t,this._contextSyncTime=0,this._loader=r,this._stream={},this._stream.id=a.id,this._stream.start=a.start,this._stream.duration=a.duration,this._stream.segmentDuration=a.segmentDuration,this._stream.segmentStart=a.segmentStart,this._stream.segmentEnd=a.segmentStart-1+Math.ceil(a.duration/a.segmentDuration),this._stream.channelCount=a.channelCount,this._stream.templateUrl=a.templateUrl,this._buffer={},this._buffer.segments=[],this._buffer.frontIndex=0,this._buffer.size=Math.ceil(a.bufferTime/a.segmentDuration),this._play={},this._play.initial=0,this._play.offset=0,this._play.duration=0,this._play.loop=!1,this._play.endedCallback=null}return r(e,[{key:"prime",value:function(){var e=arguments.length<=0||void 0===arguments[0]?0:arguments[0],t=arguments.length<=1||void 0===arguments[1]?!0:arguments[1],n=this,r=arguments.length<=2||void 0===arguments[2]?0:arguments[2],a=arguments.length<=3||void 0===arguments[3]?this._stream.duration-r:arguments[3];this._play.initial=e,this._play.loop=t,this._play.offset=r,this._play.duration=a,this._buffer.segments=[],this._buffer.frontIndex=0,this._play.startOverlap=(this._stream.segmentDuration-(this._stream.start-this._play.offset)%this._stream.segmentDuration)%this._stream.segmentDuration,this._play.endOverlap=(this._stream.segmentDuration-(this._play.startOverlap+this._play.duration)%this._stream.segmentDuration)%this._stream.segmentDuration,this._play.initialOverlap=this._play.initial%this._stream.segmentDuration%this._stream.segmentDuration,this._play.startSegment=this._stream.segmentStart+Math.floor((this._play.offset-this._stream.start)/this._stream.segmentDuration),this._play.endSegment=this._play.startSegment-1+Math.ceil((this._play.startOverlap+this._play.duration)/this._stream.segmentDuration),this._play.initialSegment=this._stream.segmentStart+Math.floor((this._play.offset+this._play.initial-this._stream.start)/this._stream.segmentDuration),this._play.segmentsPerLoop=1+this._play.endSegment-this._play.startSegment;for(var i=[],o=function(e){var t=n._getTemplateForNthSegment(e);n._buffer.segments.push(t),t.number>=n._stream.segmentStart&&t.number<=n._stream.segmentEnd&&i.push(n._loader.load(t.url).then(function(e){n._addDataToSegment(e,t.n)}))},u=0;u<this._buffer.size;u++)o(u);return Promise.all(i)}},{key:"start",value:function(){var e=arguments.length<=0||void 0===arguments[0]?0:arguments[0],t=arguments[1];this._contextSyncTime=e,this._play.endedCallback=t,this._start()}},{key:"stop",value:function(){this._stop()}},{key:"_manageBuffer",value:function(){var e=this,t=this._buffer.segments[this._buffer.frontIndex],n=t.when+t.duration,r=this._getCurrentSyncTime();r>n&&(!this._play.loop&&t.number>=this._play.endSegment?this._end():!function(){var n=t.n+e._buffer.size,r=e._getTemplateForNthSegment(n);e._buffer.segments[e._buffer.frontIndex]=r,e._buffer.frontIndex++,e._buffer.frontIndex=e._buffer.frontIndex%e._buffer.size,r.number>=e._stream.segmentStart&&r.number<=e._stream.segmentEnd&&e._loader.load(r.url).then(function(t){e._addDataToSegment(t,r.n)})}())}},{key:"_getCurrentSyncTime",value:function(){return this._context.currentTime-this._contextSyncTime}},{key:"_getTemplateForNthSegment",value:function(e){var t=e+this._play.initialSegment-this._play.startSegment,n=this._play.loop?Math.floor(t/this._play.segmentsPerLoop):0,r=this._play.loop?t%this._play.segmentsPerLoop:t,a=this._play.startSegment+r,i=this._stream.templateUrl.replace("$Number",a),o=-this._play.startOverlap-this._play.initial+n*this._play.duration+r*this._stream.segmentDuration,u=0,s=this._stream.segmentDuration;return 0===e&&(o+=this._play.initialOverlap,s-=this._play.initialOverlap,u+=this._play.initialOverlap),a===this._play.startSegment&&(o+=this._play.startOverlap,s-=this._play.startOverlap,u+=this._play.startOverlap),a===this._play.endSegment&&(s-=this._play.endOverlap),{n:e,number:a,url:i,when:o,offset:u,duration:s}}},{key:"_addDataToSegment",value:function(e,t){for(var n=0;n<this._buffer.segments.length;n++){var r=this._buffer.segments[n];r.n===t&&(r.data=e)}}},{key:"_start",value:function(){var e=this;this.manageBufferInterval=setInterval(function(){return e._manageBuffer()},this._stream.segmentDuration/4*1e3)}},{key:"_stop",value:function(){clearInterval(this.manageBufferInterval)}},{key:"_end",value:function(){this._stop(),this._play.endedCallback&&this._play.endedCallback()}},{key:"channelCount",get:function(){return this._stream.channelCount}}]),e}();t["default"]=a},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var u=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),s=n(1),l=n(14),f=r(l),c=function(e){function t(e,n){a(this,t);var r=i(this,Object.getPrototypeOf(t).call(this,e,new s.Loader("json"),n));return r._metadataCallback=null,r}return o(t,e),u(t,[{key:"_addDataToSegment",value:function(e,t){for(var n=0;n<this._buffer.segments.length;n++){var r=this._buffer.segments[n];r.n===t&&(r.metadata=e,this._metadataCallback&&this._metadataCallback(r))}}},{key:"metadataCallback",get:function(){return this._metadataCallback()},set:function(e){if(!(e&&e instanceof Function))throw new Error("Invalid parameter callback. Must be of type Function.");this._metadataCallback=e}}]),t}(f["default"]);t["default"]=c}]);